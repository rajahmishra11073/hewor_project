{% extends 'core/base.html' %}
{% load static %}

{% block title %}Case Studies | Hewor Agency{% endblock %}
{% block meta_description %}See how Hewor Agency has helped clients achieve success with professional thesis formatting
and PPT design services.{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row text-center mb-5" data-aos="fade-up">
        <div class="col-lg-8 mx-auto">
            <h1 class="display-4 fw-bold mb-3 premium-heading">{{ setting.case_studies_title }}</h1>
            <h5 class="text-primary mb-3">{{ setting.case_studies_subtitle }}</h5>
            <p class="lead text-muted">{{ setting.case_studies_description }}</p>
        </div>
    </div>

    <!-- Dynamic Case Studies Loop -->
    {% for case in case_studies %}
    <div class="glass-card mb-5 p-4" data-aos="fade-up">
        <div class="row align-items-center {% if forloop.counter|divisibleby:2 %}flex-md-row-reverse{% endif %}">
            <div class="col-md-5 mb-4 mb-md-0">
                <div class="rounded-4 overflow-hidden" style="height: 250px;">
                    {% if case.image %}
                    <img src="{{ case.image.url }}" alt="{{ case.title }}" class="w-100 h-100 object-fit-cover">
                    {% else %}
                    <div class="w-100 h-100 bg-secondary d-flex align-items-center justify-content-center text-white">
                        No Image
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="col-md-7 {% if forloop.counter|divisibleby:2 %}pe-md-4{% else %}ps-md-4{% endif %}">
                <span class="badge bg-{{ case.category_color }} mb-2">{{ case.category }}</span>
                <h3 class="fw-bold">{{ case.title }}</h3>
                <p class="text-muted mt-3">
                    <strong>Challenge:</strong> {{ case.challenge }}
                </p>
                <p class="text-muted">
                    <strong>Solution:</strong> {{ case.solution }}
                </p>
                <div class="d-flex align-items-center mt-4">
                    <div class="me-3">
                        <h4 class="fw-bold text-success mb-0">{{ case.stat1_value }}</h4>
                        <small>{{ case.stat1_label }}</small>
                    </div>
                    <div class="border-start ps-3">
                        <h4 class="fw-bold text-primary mb-0">{{ case.stat2_value }}</h4>
                        <small>{{ case.stat2_label }}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="text-center py-5">
        <p class="text-muted">No case studies added yet.</p>
    </div>
    {% endfor %}

    <!-- Dynamic Stats Section -->
    <div class="row g-4 mt-5" data-aos="fade-up" data-aos-delay="200">
        {% for stat in agency_stats %}
        <div class="col-md-4">
            <div class="glass-card p-4 text-center hover-up">
                <h2 class="display-4 fw-bold text-{{ stat.icon_color }} counter-animate">{{ stat.value }}</h2>
                <p class="text-muted">{{ stat.label }}</p>
            </div>
        </div>
        {% empty %}
        <!-- Optional fallback or empty -->
        {% endfor %}
    </div>

    <div class="text-center mt-5 pt-4">
        <a href="{% url 'signup' %}" class="btn btn-primary btn-lg">Start Your Success Story</a>
    </div>

</div>
<!-- GSAP Case Studies Page Animations -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        gsap.registerPlugin(ScrollTrigger);

        // 1. Header Animations
        gsap.from('h1.display-4', {
            duration: 1,
            y: 50,
            opacity: 0,
            delay: 0.2,
            ease: "power3.out"
        });

        gsap.from('.lead.text-muted', {
            duration: 1,
            y: 30,
            opacity: 0,
            delay: 0.4,
            ease: "power3.out"
        });

        // 2. Case Study Cards Reveal - Modified for visibility
        const cases = document.querySelectorAll('.glass-card.mb-5');
        cases.forEach((card, i) => {
            gsap.from(card, {
                scrollTrigger: {
                    trigger: card,
                    start: "top 90%", // Trigger earlier
                },
                duration: 1,
                y: 50, // Only animate Y, not X
                // REMOVED opacity: 0 to ensure visibility if animation fails
                ease: "power3.out"
            });
        });

        // 3. Stats Counter Animation
        const stats = document.querySelectorAll('.counter-animate'); // Targeting ONLY specific numbers
        stats.forEach(stat => {
            // Check if it's a stat number (simple heuristic: contains digit)
            if (/\d/.test(stat.innerText)) {
                let rawVal = stat.innerText.replace(/\D/g, ''); // Extract number
                let suffix = stat.innerText.replace(/[0-9]/g, ''); // Extract suffix (+, %)
                let targetVal = parseInt(rawVal);

                if (!isNaN(targetVal)) {
                    gsap.from(stat, {
                        scrollTrigger: {
                            trigger: stat,
                            start: "top 95%", // Trigger earlier
                        },
                        innerText: 0, // Animate FROM 0
                        duration: 2.5,
                        snap: { innerText: 1 },
                        onUpdate: function () {
                            this.targets()[0].innerText = Math.ceil(this.targets()[0].innerText) + suffix;
                        },
                        ease: "power2.out"
                    });
                }
            }
        });
    });
</script>
{% endblock %}