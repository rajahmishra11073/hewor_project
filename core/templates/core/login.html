{% extends 'core/base.html' %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-5">
        <div class="card glass-card no-tilt border-0">
            <div class="card-body p-5">
                <h3 class="text-center fw-bold mb-4">Login to Hewor</h3>

                <!-- Google Sign In -->
                <button type="button" class="btn btn-outline-dark w-100 mb-3 py-2 fw-bold" onclick="googleLogin()">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google"
                        style="width: 20px; margin-right: 10px;">
                    Sign in with Google
                </button>

                <div class="text-center text-muted mb-3">
                    <small>OR</small>
                </div>

                <form method="POST">
                    {% csrf_token %}
                    <!-- Google Token (Hidden) -->
                    <input type="hidden" name="google_id_token" id="google_id_token">

                    <div class="mb-3">
                        <label class="form-label fw-bold">Email or Phone Number</label>
                        <input type="text" name="identifier" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Password</label>
                        <input type="password" name="password" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-2">Login</button>
                </form>

                <p class="text-center mt-3">New User? <a href="{% url 'signup' %}" class="fw-bold text-primary">Sign
                        Up</a></p>
                <div id="error-message" class="alert alert-danger mt-3" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function googleLogin() {
        const provider = new firebase.auth.GoogleAuthProvider();
        firebase.auth().signInWithPopup(provider)
            .then((result) => {
                const user = result.user;
                user.getIdToken().then((idToken) => {
                    // Send token to backend
                    const form = document.querySelector('form');
                    const tokenInput = document.getElementById('google_id_token');

                    // Create input if it doesn't exist (safety check)
                    if (!tokenInput) {
                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = 'google_id_token';
                        input.value = idToken;
                        form.appendChild(input);
                    } else {
                        tokenInput.value = idToken;
                    }

                    form.submit();
                });
            }).catch((error) => {
                console.error(error);
                const errDiv = document.getElementById('error-message');
                errDiv.innerText = error.message;
                errDiv.style.display = 'block';
            });
    }
</script>
{% endblock %}